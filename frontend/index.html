<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Smart News Bot</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<!-- PWA-ish polish -->
<meta name="theme-color" content="#020617">

<style>
/* ================= ROOT ================= */
:root {
  --bg-dark: radial-gradient(circle at top, #1e293b, #020617);
  --bg-light: linear-gradient(135deg, #e0f2fe, #f8fafc);
  --card-dark: rgba(15, 23, 42, 0.85);
  --card-light: rgba(255,255,255,0.85);
  --accent: #3b82f6;
  --accent-2: #22d3ee;
  --text-dark: #e5e7eb;
  --text-light: #020617;
}

/* Auto system theme */
@media (prefers-color-scheme: light) {
  body:not(.dark) {
    --bg: var(--bg-light);
    --card: var(--card-light);
    --text: var(--text-light);
  }
}

body.dark {
  --bg: var(--bg-dark);
  --card: var(--card-dark);
  --text: var(--text-dark);
}

body {
  margin: 0;
  height: 100vh;
  background: var(--bg);
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  color: var(--text);
  transition: background .4s ease;
  padding-bottom: env(safe-area-inset-bottom);
}

* { box-sizing: border-box; }

/* ================= LAYOUT ================= */

.container {
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
}

.auth-box, .top-bar {
  background: var(--card);
  backdrop-filter: blur(16px);
  padding: 10px;
  border-radius: 16px;
  display: flex;
  gap: 8px;
  box-shadow: 0 20px 50px rgba(0,0,0,.4);
}

.chatbox {
  width: min(420px, 94vw);
  height: 80vh;
  background: var(--card);
  backdrop-filter: blur(18px);
  border-radius: 22px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-shadow: 0 30px 80px rgba(0,0,0,.6);
}

/* ================= HEADER ================= */

.header {
  padding: 14px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 600;
  border-bottom: 1px solid rgba(255,255,255,.1);
}

.header small {
  opacity: .7;
  font-weight: 400;
  font-size: 11px;
}

/* ================= QUICK ACTIONS ================= */

.quick-actions {
  display: flex;
  gap: 6px;
  padding: 8px;
  justify-content: center;
}

.quick-actions button {
  font-size: 12px;
  padding: 6px 12px;
  border-radius: 999px;
  background: rgba(255,255,255,.12);
  color: var(--text);
  border: none;
  cursor: pointer;
  transition: transform .15s ease, background .15s ease;
}
.quick-actions button:hover {
  background: rgba(255,255,255,.22);
  transform: translateY(-1px);
}

/* ================= MESSAGES ================= */

#messages {
  flex: 1;
  padding: 16px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  scroll-behavior: smooth;
}

.msg {
  max-width: 78%;
  padding: 10px 12px;
  border-radius: 18px;
  font-size: 13px;
  line-height: 1.45;
  white-space: pre-wrap;
  animation: pop .25s ease;
}

@keyframes pop {
  from { opacity: 0; transform: translateY(8px) scale(.96); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.msg .time {
  display: block;
  font-size: 10px;
  opacity: .5;
  margin-top: 4px;
}

.user {
  align-self: flex-end;
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  color: white;
}

.bot {
  align-self: flex-start;
  background: rgba(255,255,255,.12);
}

/* ================= TYPING ================= */

.typing span {
  width: 6px;
  height: 6px;
  background: #94a3b8;
  border-radius: 50%;
  display: inline-block;
  animation: blink 1.4s infinite both;
}
.typing span:nth-child(2){animation-delay:.2s}
.typing span:nth-child(3){animation-delay:.4s}

@keyframes blink {
  0%{opacity:.2} 20%{opacity:1} 100%{opacity:.2}
}

/* ================= CHIPS ================= */

.chips {
  display: flex;
  gap: 6px;
  padding: 6px 12px;
  justify-content: center;
}

.chips span {
  padding: 4px 10px;
  background: rgba(255,255,255,.12);
  border-radius: 999px;
  font-size: 11px;
  cursor: pointer;
  transition: background .15s ease;
}
.chips span:hover {
  background: rgba(255,255,255,.22);
}

/* ================= INPUT ================= */

.input-row {
  display: flex;
  padding: 14px;
  gap: 8px;
  border-top: 1px solid rgba(255,255,255,.1);
}

input {
  flex: 1;
  padding: 12px;
  border-radius: 16px;
  border: none;
  outline: none;
  background: rgba(2,6,23,.9);
  color: var(--text);
  font-size: 13px;
  transition: box-shadow .2s ease;
}
input:focus {
  box-shadow: 0 0 0 2px rgba(59,130,246,.6);
}

button {
  padding: 12px 16px;
  border-radius: 16px;
  border: none;
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  color: white;
  cursor: pointer;
  font-size: 13px;
  transition: transform .15s ease, box-shadow .15s ease;
}
button:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 20px rgba(59,130,246,.5);
}
button:active { transform: scale(.96); }

.secondary { background: rgba(100,116,139,.8); }
</style>
</head>

<body class="dark">

<audio id="sendSound" src="https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3"></audio>
<audio id="receiveSound" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-951.mp3"></audio>

<div class="container">

<div class="auth-box" id="authBox">
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <button class="secondary" onclick="register()">Register</button>
</div>

<div class="top-bar" id="topBar" style="display:none;">
  <button class="secondary" onclick="toggleTheme()">ðŸŒ— Theme</button>
  <button class="secondary" onclick="logout()">Logout</button>
</div>

<div class="chatbox">
  <div class="header">
    ðŸ“° Smart News Bot
    <small id="status">Online</small>
  </div>

  <div class="quick-actions">
    <button onclick="quickAsk('AI news')">ðŸ¤– AI</button>
    <button onclick="quickAsk('Tech news')">ðŸ’» Tech</button>
    <button onclick="quickAsk('News')">ðŸ“° News</button>
  </div>

  <div id="messages"></div>

  <div class="chips">
    <span onclick="quickAsk('only ai news')">Only AI</span>
    <span onclick="quickAsk('only tech news')">Only Tech</span>
    <span onclick="quickAsk('reset')">Reset</span>
  </div>

  <div class="input-row">
    <input id="userInput" disabled placeholder="Login to start chatting...">
    <button id="sendBtn" disabled onclick="sendMessage()">Send</button>
  </div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
const API="http://127.0.0.1:8000";
const messages=document.getElementById("messages");
const input=document.getElementById("userInput");
const sendBtn=document.getElementById("sendBtn");
const authBox=document.getElementById("authBox");
const topBar=document.getElementById("topBar");
const statusText=document.getElementById("status");

let USER_ID=null;

/* -------- Helpers -------- */

function timeNow(){
  return new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
}

function addMessage(text,who){
  const d=document.createElement("div");
  d.className=`msg ${who}`;
  d.innerHTML=`${text}<span class="time">${timeNow()}</span>`;
  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
  document.getElementById(who==="user"?"sendSound":"receiveSound").play();
}

function showTyping(){
  statusText.textContent="Thinkingâ€¦";
  const d=document.createElement("div");
  d.className="msg bot";
  d.id="typing";
  d.innerHTML='<div class="typing"><span></span><span></span><span></span></div>';
  messages.appendChild(d);
}

function removeTyping(){
  statusText.textContent="Online";
  document.getElementById("typing")?.remove();
}

function quickAsk(text){input.value=text;sendMessage();}
function toggleTheme(){document.body.classList.toggle("dark");}

function celebrate(){
  confetti({particleCount:140,spread:90,origin:{y:.6}});
}

/* -------- Init -------- */
addMessage("Hey ðŸ‘‹ Ask me for AI news, tech news, or general news.","bot");

/* -------- Auth -------- */

async function login(){
  const res=await fetch(`${API}/login`,{
    method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username:username.value,password:password.value})
  });
  const data=await res.json();
  if(!data.user_id){alert(data.error||"Login failed");return;}

  USER_ID=data.user_id;
  authBox.style.display="none";
  topBar.style.display="flex";
  input.disabled=false;
  sendBtn.disabled=false;
  input.placeholder="Type a message...";
  celebrate();
}

async function register(){
  const res=await fetch(`${API}/register`,{
    method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username:username.value,password:password.value})
  });
  const data=await res.json();
  alert(data.error||"Registered. Login now.");
}

function logout(){
  USER_ID=null;
  authBox.style.display="flex";
  topBar.style.display="none";
  input.disabled=true;
  sendBtn.disabled=true;
  messages.innerHTML="";
  addMessage("Logged out ðŸ‘‹","bot");
}

/* -------- Chat -------- */

async function sendMessage(){
  const text=input.value.trim();
  if(!USER_ID||!text) return;

  addMessage(text,"user");
  input.value="";
  sendBtn.disabled=true;
  showTyping();

  try{
    const res=await fetch(`${API}/chat`,{
      method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:text,user_id:USER_ID})
    });
    const data=await res.json();
    removeTyping();
    addMessage(data.reply||"No response","bot");
  }catch{
    removeTyping();
    addMessage("Server error âŒ","bot");
  }finally{sendBtn.disabled=false;}
}

input.addEventListener("keydown",e=>{if(e.key==="Enter")sendMessage();});
</script>
</body>
</html>